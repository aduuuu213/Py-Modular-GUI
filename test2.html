

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
  <head>
	<title>用箱申请查询</title>
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	



<link rel="stylesheet" type="text/css" href="/mskeir2/css/default.css;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614"  />
<link rel="stylesheet" type="text/css" href="/mskeir2/easyui1.2.2/themes/default/easyui.css;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614" />
<link rel="stylesheet" type="text/css" href="/mskeir2/easyui1.2.2/themes/icon.css;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614" />
	
<script type="text/javascript" src="/mskeir2/easyui1.2.2/jquery-1.4.4.min.js;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614"></script>
<script type="text/javascript" src="/mskeir2/easyui1.2.2/jquery.easyui.min.js;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614"></script>

		<script type="text/javascript" src="/mskeir2/easyui1.2.2/locale/easyui-lang-zh_CN.js;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614"></script>

<script type="text/javascript" src="/mskeir2/js/json2.js;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614"></script>	
<script type="text/javascript" src="/mskeir2/js/util.js;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614"></script>	
<script>
$.fn.datebox.defaults.formatter = function(date) 
{
	var y = date.getFullYear();
	var m = date.getMonth() + 1;
	var d = date.getDate();
	var returnval = y + '-' + (m < 10 ? '0' + m : m) + '-' + (d < 10 ? '0' + d : d);
	return returnval;
};

$.fn.datebox.defaults.parser = function(s){
	var t = Date.parse(s);
	if (!isNaN(t)){
		return new Date(t);
	} else {
		return new Date();
	}
}
</script>

	<script language="javascript" src="/mskeir2/js/LodopFuncs.js;jsessionid=bKQkzBel0TQgdUAxw1zZtY5L-qM5vE7GEEZg48KdJmtw6N9re-Vq!1271875614?version=201510151108"></script>
	<object id="LODOP" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA" width=0 height=0>
	  <param name="CompanyName" value="上海亿通国际股份有限公司" />
	  <param name="License" value="452717366717172919278901905623" />
	  <embed id="LODOP_EM" type="application/x-print-lodop" width=0 height=0 CompanyName="上海亿通国际股份有限公司" License="452717366717172919278901905623"></embed>
	</object>
	<style>
	.a2 {
		font-weight: bolder;
		font-size: 12px;
		color: red;
		text-decoration: none;
	}
	.a2:hover {
		font-weight: bolder;
		font-size: 12px;
		color: red;
		text-decoration: underline;
	}
	.a3 {
		font-weight: normal;
		font-size: 12px;
		color: red;
		text-decoration: none;
	}
	.a3:hover {
		font-weight: normal;
		font-size: 12px;
		color: red;
		text-decoration: underline;
	}
	</style>
	<script type="text/javascript">
	var model = {"location":"SGH"};
	
	function buildUrl(url){
		if(url.indexOf("?") >= 0){
			return "https://www.eptrade.cn:443/mskeir2/" + url + "&shipCode=" + model.location;
		}else{
			return "https://www.eptrade.cn:443/mskeir2/" + url + "?shipCode=" + model.location;
		}
	}
	
	function queryTable() {
		bookingno = $('#bookingno').val().trim();
		
		
		var barcode = $('#barcode').val().trim();
		var sipgEirNo = $('#sipgEirNo').val().trim();
		
		if (checkNoticeSet(bookingno)) {
			
			if (barcode != "") {
				bookingno =	getBookingnoByBarcode(barcode);
				if(bookingno != ""){
				openApplyPageByBarcode(bookingno);
				}
			}else if (sipgEirNo != "") {
				bookingno =	getBookingnoBySipgEirNo(sipgEirNo);
				if(bookingno != ""){
				openApplyPageBySipgEirNo(bookingno);
				}
			} else 
			 
			if(bookingno != "") {
				openApplyPage(bookingno);
			} else {
				$('#tt').datagrid('reload', form2json('searchApply'));
			}	
		} else {
			$.messager.alert("系统信息","您有未读的通知，请先至主页面中阅读！","warning");
			return;
		}
		
	}

	function getBookingnoByBarcode(barcode){
		var result = "";
		$.ajax({
			url:"mskCarrierApplyCtnr.do/getBookingnoByBarcode.do",
			type:'POST',
			cache:false,
			async: false,
			data:{"barcode": barcode},
			dataType:'json',
			success: function (data) {
				if(data.bookingno!=""){
					result = data.bookingno;
				}else{
					$.messager.alert("提示","该票订舱不存在！","warning");
					return;
				}
			}
		});
		return result;
	}
	function getBookingnoBySipgEirNo(sipgEirNo){
		var result = "";
		$.ajax({
			url:"mskCarrierApplyCtnr.do/getBookingnoBySipgEirNo.do",
			type:'POST',
			cache:false,
			async: false,
			data:{"sipgEirNo":sipgEirNo},
			dataType:'json',
			success: function (data) {
				if(data.bookingno!=""){
					result = data.bookingno;
				}else{
					$.messager.alert("提示","该票订舱不存在！","warning");
					return;
				}
			}
		});
		return result;
	}
	function checkNoticeSet(bookingNo) {
		if(eval('false')) return true;
		var obj = "'A','C'";
		var result = true;
		var currentDate = new SimpleDateFormat("yyyy-MM-dd").format(new Date());
		$.ajax({
			url:"mskCarrierApplyCtnr.do/checkNoticeSet.do",
			type:'POST',
			cache:false,
			async: false,
			data:{"obj": obj, "location": 'SGH',"startTime":currentDate,"bookingNo":bookingNo},
			dataType:'json',
			success: function (data) {
				if(data){
					result = data.flag;
				}
			}
		});
		return result;
	}
	function openApplyPageByBarcode(bookingno){
		if (!checkNoticeSet(bookingno)) {
			$.messager.alert("系统信息","您有未读的通知，请先至主页面中阅读！","warning");
			return;
		}
		jQuery.ajax({
			url: buildUrl("mskCarrierApplyCtnr.do/validateBeforeOperate.do") + "&bookingno=" + bookingno,
			type: 'POST',
			cache: false,
			data: {},
			dataType: 'json',
			success: function(data){
				if(data && !data.isValid){
					if(!data.isCompanyUser){
						jQuery.messager.alert("系统信息", data.message, "warning");
						return;
					}else{
						jQuery.messager.confirm("提示", "该票订舱船公司已删除，操作是否继续？",function(event){
							if(event){
								var url = buildUrl("mskCarrierApplyCtnr.do/operate.do") + "&bookingno=" + bookingno;
								window.parent.addTab(bookingno + '_' + model.location, url);
							}else
								return;
						});
					}
				}else{
					var url = buildUrl("mskCarrierApplyCtnr.do/operate.do") + "&bookingno=" + bookingno;
					window.parent.addTab(bookingno + '_' + model.location, url);
				}
			},
			error: function(){
				jQuery.messager.alert("系统信息", "操作出错！", "warning");
			}
		});
	}function openApplyPageBySipgEirNo(bookingno){
		if (!checkNoticeSet(bookingno)) {
			$.messager.alert("系统信息","您有未读的通知，请先至主页面中阅读！","warning");
			return;
		}
		jQuery.ajax({
			url: buildUrl("mskCarrierApplyCtnr.do/validateBeforeOperate.do") + "&bookingno=" + bookingno,
			type: 'POST',
			cache: false,
			data: {},
			dataType: 'json',
			success: function(data){
				if(data && !data.isValid){
					if(!data.isCompanyUser){
						jQuery.messager.alert("系统信息", data.message, "warning");
						return;
					}else{
						jQuery.messager.confirm("提示", "该票订舱船公司已删除，操作是否继续？",function(event){
							if(event){
								var url = buildUrl("mskCarrierApplyCtnr.do/operate.do") + "&bookingno=" + bookingno;
								window.parent.addTab(bookingno + '_' + model.location, url);
							}else
								return;
						});
					}
				}else{
					var url = buildUrl("mskCarrierApplyCtnr.do/operate.do") + "&bookingno=" + bookingno;
					window.parent.addTab(bookingno + '_' + model.location, url);
				}
			},
			error: function(){
				jQuery.messager.alert("系统信息", "操作出错！", "warning");
			}
		});
	}
	function openApplyPage(bookingno){
		if (!checkNoticeSet(bookingno)) {
			$.messager.alert("系统信息","您有未读的通知，请先至主页面中阅读！","warning");
			return;
		}
		jQuery.ajax({
			url: buildUrl("mskCarrierApplyCtnr.do/validateBeforeOperate.do") + "&bookingno=" + bookingno,
			type: 'POST',
			cache: false,
			data: {},
			dataType: 'json',
			success: function(data){
				if(data && !data.isValid){
					if(!data.isCompanyUser){
						jQuery.messager.alert("系统信息", data.message, "warning");
						return;
					}else{
						jQuery.messager.confirm("提示", "该票订舱船公司已删除，操作是否继续？",function(event){
							if(event){
								var url = buildUrl("mskCarrierApplyCtnr.do/operate.do") + "&bookingno=" + bookingno;
								window.parent.addTab(bookingno + '_' + model.location, url);
							}else
								return;
						});
					}
				}else{
					var url = buildUrl("mskCarrierApplyCtnr.do/operate.do") + "&bookingno=" + bookingno;
					window.parent.addTab(bookingno + '_' + model.location, url);
				}
			},
			error: function(){
				jQuery.messager.alert("系统信息", "操作出错！", "warning");
			}
		});
	}
	
	function showdate(n) {
		var uom = new Date();
		uom.setDate(uom.getDate() + n);
		month_str = uom.getMonth() + 1;
		if (month_str < 10)
			month_str = "0" + month_str;
		day_str = uom.getDate();
		if (day_str < 10)
			day_str = "0" + day_str;
		uom = uom.getFullYear() + "-" + month_str + "-" + day_str;
		return uom;
	}
	
	function renderOnInit(){
		$('#begainApplyTime').datebox('setValue', showdate(-3));
		$('#endApplyTime').datebox('setValue', showdate(0));
// 		$('#startTime').datebox('setValue', showdate(-3));
// 		$('#endTime').datebox('setValue', showdate(0));
		$(".datebox :text").attr("readonly", "readonly");

		var statusMap = [{code:"",value:"全部"},{code:"2",value:"申请中"},{code:"3",value:"申请成功"},{code:"4",value:"拒绝申请"}];
		$("#q-status").combobox({
			valueField:'code',
			textField:'value',
			data:statusMap,
			onLoadSuccess: function() {
				$(this).combobox('select','');
			}
		});
		$('#tt').datagrid({
			title: '用箱申请查询',
			url: buildUrl('mskCarrierApplyCtnr.do/findAppliedBills.do'),
			singleSelect: true,
// 			toolbar:[{text:'批量打印',iconCls:'icon-print',handler: openPrintRosWindow}
// 			],
			queryParams: form2json('searchApply'),
			rownumbers: true,
			columns: [[
					{field : 'vessel', title : '船名', width : 180},
					{field : 'voyage', title : '航次', width : 80},
					{field : 'bookingno', title : '订舱号', width : 180},
					{field : 'className', title : '操作', width : 80,
						formatter : function(value, row, index) {
							return "<a href=\"#\" onclick=\"openApplyPage('" + row.bookingno + "')\">操作</a>";
						}
					}]],
			pagination: true,
			sortOrder: 'asc',
			onLoadSuccess:function(data){
				if(data && !data.isValid){
					jQuery.messager.alert("系统信息", data.message, "warning");
					return;
				}
				if(!StringUtils.isBlank(data.message)){
					jQuery.messager.alert("系统信息", data.message, "warning");
				}
			}
		});
	    
		
	}
	
	$(function() {
		if(!StringUtils.isBlank(model.message)){
			jQuery.messager.alert("系统信息", model.message, "warning");
		}

		
		renderOnInit();
		queryTable();
	});
	
	

	</script>
</head>
<body>
	<form method="post" name="searchApply" id="searchApply">
		<table border="0" cellpadding="0" class="query_a">
			<tr>
				<td class="odd2">
					订舱号
				</td>
				<td>
					<input type="text"
						name="param.mskeirBizBill.bookingno"
						id="bookingno" size="30" maxlength="20" value=""
						onblur="this.value=this.value.toUpperCase().trim().replace(/\s*/g,'')" class="input-text">
				</td>
				<td class="odd2">
					船名
				</td>
				<td>
					<input type="text"
						name="param.mskeirBizBill.vessel" size="30"
						maxlength="35" value=""
						onblur="this.value=this.value.toUpperCase().trim()" class="input-text" />
				</td>
				<td rowspan="4">
					<a href="#" id="searchBtn_1" class="easyui-linkbutton" plain="true"
						iconCls="icon-search" onclick="queryTable()">查询</a>
				</td>
			</tr>
			
			<tr>
				<td class="odd2">
					条形码
				</td>
				<td>
					<input type="text"
						name="param.barcode"
						id="barcode" size="30" maxlength="20" value=""
						onblur="this.value=this.value.toUpperCase().trim()" class="input-text">
				</td>
				<td class="odd2">
					电子EIR号
				</td>
				<td>
					<input type="text"
						name="param.sipgEirNo" size="30"
						id = "sipgEirNo"
						maxlength="35" value=""
						onblur="this.value=this.value.toUpperCase().trim()" class="input-text" />
				</td>
				
			</tr>
			
			<tr>
				<td class="odd2">
					状态
				</td>
				<td>
					<select id="q-status" name="param.mskeirBizApply.status" class="easyui-combobox" style="width: 178px;">
						
					</select>

				</td>
				<td class="odd2">
					航次
				</td>
				<td>
					<input type="text"
						name="param.mskeirBizBill.voyage" size="30"
						maxlength="10" value=""
						onblur="this.value=this.value.toUpperCase().trim()" class="input-text" />
				</td>
			</tr>
			<tr>
				<td class="odd2">
					日期
				</td>
				<td>
					<input id="begainApplyTime" class="easyui-datebox"
						name="param.greateEqual.mskeirBizApply.applyTime" size="30"
						maxlength="10" targetDateFormat="yyyyMMddHHmmss" style="width: 178px" />
				</td>
				<td class="odd2">
					~
				</td>
				<td>
					<input id="endApplyTime" class="easyui-datebox"
						name="param.lessEqual.mskeirBizApply.applyTime" size="30"
						maxlength="10" targetDateFormat="yyyyMMddHHmmss" fixedEndTime="true" style="width: 178px" />
				</td>
			</tr>
		</table>
		<input name="className" type="hidden"
			value="com.easipass.business.model.MskeirBizApply  mskeirBizApply">
	</form>
	<table id="tt"></table>

</body>
</html>

